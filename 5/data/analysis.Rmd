---
title: "Untitled"
output: html_document
date: "2025-05-01"
---

# パッケージ読み込み・諸定数定義
```{r}
library(readxl)
library(tidyverse)
library(ggplot2)
library(dplyr)
```

# データ読み込み
```{r}
save_dir <- "5/data/img"
path <- "5\\data\\pe2_exp5.xlsx"
# excel fileのシートを列挙
sheets <- excel_sheets(path)
sheets
```

# 課題1
## パワーメータによる測定
```{r}
save_dir <- "5/data/1_1"
if (!dir.exists(save_dir)) dir.create(save_dir)

data <- read_excel(path, sheet = "power cable1")
freq <- data$`req [MHz]`
a_power <- data$`A power [dBm]`
power_ratio <- data$`B/A [dB]`
decay_ratio <- data$`減衰率 [dBm^-1]`

p <- ggplot(data, aes(x = freq, y = a_power)) +
    geom_point() +
    scale_x_log10() +
    scale_y_continuous(limits = c(NA, 0)) +
    geom_line() +
    labs(
        x = "Frequency [MHz]",
        y = "A power [dBm]"
    ) +
    theme_light()
ggsave(
    p,
    filename = file.path(save_dir, "power_vs_freq.pdf"),
    width = 175, height = 75, unit = "mm", dpi = 300
)

p2 <- ggplot(data, aes(x = freq, y = power_ratio)) +
    geom_point() +
    scale_x_log10() +
    geom_line() +
    labs(
        x = "Frequency [MHz]",
        y = "B/A [dB]"
    ) +
    theme_light()
ggsave(
    p2,
    filename = file.path(save_dir, "power_ratio_vs_freq.pdf"),
    width = 175, height = 75, unit = "mm", dpi = 300
)

p3 <- ggplot(data, aes(x = freq, y = decay_ratio)) +
    geom_point() +
    scale_x_log10() +
    geom_line() +
    labs(
        x = "Frequency [MHz]",
        y = "Attenuation [dB/m]"
    ) +
    theme_light()
ggsave(
    p3,
    filename = file.path(save_dir, "decay_ratio_vs_freq.pdf"),
    width = 175, height = 75, unit = "mm", dpi = 300
)
```

```{r}
save_dir <- "5/data/1_2"
if (!dir.exists(save_dir)) dir.create(save_dir)

data <- read_excel(path, sheet = "power_cable2 (2)")
freq <- data$`req [MHz]`
a_power <- data$`A power [dBm]`
power_ratio <- data$`B/A [dB]`
phase_delay <- data$`phase delay [rad]`

p <- ggplot(data, aes(x = freq, y = a_power)) +
    geom_point() +
    geom_line() +
    labs(
        x = "Frequency [MHz]",
        y = "A power [dBm]"
    ) +
    theme_light()
ggsave(
    p,
    filename = file.path(save_dir, "power_vs_freq.pdf"),
    width = 175, height = 75, unit = "mm", dpi = 300
)

p2 <- ggplot(data, aes(x = freq, y = power_ratio)) +
    geom_point() +
    geom_line() +
    labs(
        x = "Frequency [MHz]",
        y = "B/A [dB]"
    ) +
    theme_light()
ggsave(
    p2,
    filename = file.path(save_dir, "power_ratio_vs_freq.pdf"),
    width = 175, height = 75, unit = "mm", dpi = 300
)

p3 <- ggplot(data, aes(x = freq, y = phase_delay)) +
    geom_point() +
    geom_line() +
    labs(
        x = "Frequency [MHz]",
        y = "Phase difference [rad]"
    ) +
    theme_light()
ggsave(
    p3,
    filename = file.path(save_dir, "phase_delay_vs_freq.pdf"),
    width = 175, height = 75, unit = "mm", dpi = 300
)


```
